{% extends "theme.html" %}
{% block title %} About: Taskhub {% endblock %}


{% block content %}
<style>
    * 
{
  box-sizing: border-box;
}

body 
{
  font-family: Arial, Helvetica, sans-serif;  
}

#rcorners1 {
  border-radius: 25px;
  background: #598269;
  color: #fff;
  padding: 20px; 
  width: 200px;
  height: 150px;  
}

/* Style for the create task button */
#createTaskButton 
{
  top: 500px;
  right: 300px;
  padding: 10px 20px;
  background-color: #598269;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

/* Style for the pop-up modal */
.popup 
{
  display: none;
  /* Add more styles for positioning, background color, etc. */
}

.popup-content
{
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  resize: vertical;
  font-family: Arial, Helvetica, sans-serif;
  background-color: #c3d5c8;
}

input[type=text], select, textarea 
{
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  resize: vertical;
}

label
{
  padding: 12px 12px 12px 0;
  display: inline-block;
}

input[type=submit] 
{
  background-color: #04AA6D;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  float: right;
}

input[type=submit]:hover 
{
  background-color: #45a049;
}

.container 
{
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}

.col-25 
{
  float: left;
  width: 25%;
  margin-top: 6px;
}

.col-75 
{
  float: left;
  width: 75%;
  margin-top: 6px;
}

/* Clear floats after the columns */
.row::after 
{
  content: "";
  display: table;
  clear: both;
}

/* Responsive layout - when the screen is less than 600px wide, make the two columns stack on top of each other instead of next to each other */
@media screen and (max-width: 600px) 
{
  .col-25, .col-75, input[type=submit] 
  {
    width: 100%;
    margin-top: 0;
  }
}
</style>

<h1>{{ username }}'s Tasks</h1>
{% if tasksExist == 1 %}
  {% if taskCount == 1 %}
    <h3>{{ taskCount }} current task.</h3>
  {% elif taskCount > 1 %}
    <h3>{{ taskCount }} current tasks.</h3>
  {% elif taskCount == 0 %}
    <h3>You do not have any current tasks.</h3>
  {% endif %}
{% endif %}

<p align="right"><button id="createTaskButton" onclick="openModal()">Create Task</button></p>

<div id="taskCreateForm" class="popup" onsubmit="return validateForm()">
    <form class="popup-content" id="newTaskForm" method="POST">
      <span class="close">&times;</span>
      <h2>Task Creation</h2>

      <!--- task name --->
      <label for="taskName">Task name: </label>
      <input type="text" id="taskName" name = "taskName" placeholder="Task Name" required><br>
      <br>
      <!-- task type --->
      <label for="taskType">Task type: </label>
      <select id="taskType" name="taskType" required>
        <option value="choose">Please choose a type</option>
        {% for taskType in taskTypes %}
            <option value="{{ taskType }}">{{ taskType }}</option>
        {% endfor %}
      </select><br>

      <br>
    <!--- task date and time--->
      <label for="datetimeDue">Date and time due:</label>
      <input type="datetime-local" id="dateDue" name="dateDue" required><br>
      <br>

      <!--- optional --->
      <h3>Optional:</h3>

      <!-- task description -->
      <label for="taskDescription">Description: </label>
      <input type="textarea" id="taskDescription" name="taskDescription" autocomplete="off"><br>

      <!--- task location --->
      <label for="taskLocation">Add a location: </label>
      <input type="text" id="taskLocation" name = "taskLocation" placeholder="Location"><br>

      <!--- task invites --->
      <label for="taskInvite">Task invites: </label>
      <input type="text" id="taskInviteInput" placeholder="Type to search for users"><br>
      <div id="userSuggestionList" style="display: none;"></div>
    

      <!--- task reminder --->
      <label for="taskRemind">Reminder: </label>
      <select id="taskRemind" name="taskRemind">
        <option value="choose">Reminder? Y/N</option>
        <option value="yes">YES</option>
        <option value="no">NO</option>
      </select><br>

      <!--- task reminder --->
      <label for="taskRecurr">Recurring: </label>
      <select id="taskRecurr" name="taskRecurr">
        <option value="choose">Recurring? Y/N</option>
        <option value="yes">YES</option>
        <option value="no">NO</option>
      </select><br>

      <br>
      <button type="submit">Submit</button>
    </form>
</div>
<div id="alertMessage"></div>
<div>
  <br>
  <p id="rcorners1">{{taskName}}</p>
</div>

<!--Google API Script-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDoIWC5he72pbqM7s1zHyu3ef2ll6ylpHU&libraries=places"></script>

<script>
  // Get the button element
  var createTaskButton = document.getElementById("createTaskButton");

  // Get the modal element
  var modal = document.getElementById("taskCreateForm");

  // Get the close button element inside the modal
  var closeButton = modal.querySelector(".close");

  // Function to open the modal when the button is clicked
  createTaskButton.addEventListener("click", function() {
    modal.style.display = "block";
  });

  // Function to close the modal when the close button is clicked
  closeButton.addEventListener("click", function() {
    modal.style.display = "none";
  });
</script>

<script>
   function initializeAutocomplete() {
        var input = document.getElementById('taskLocation');
        var autocomplete = new google.maps.places.Autocomplete(input);
    }
    google.maps.event.addDomListener(window, 'load', initializeAutocomplete);

  function validateForm() {
    // Get the value of the due date input
    var dueDateInput = new Date(document.getElementById('dateDue').value);

    // Get the current date
    var currentDate = new Date();

    // Compare due date with current date
    if (dueDateInput <= currentDate) {
        // Display error message
        document.getElementById('alertMessage').innerHTML = 
        <div class="alert alert-dismissible alert-warning">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <h4 class="alert-heading">Warning!</h4>
            <p class="mb-0">You can't create a task in the past! Try entering a current Date!</p>
        </div>;
        return false; // Prevent form submission
    }

    return true; // Allow form submission
}
</script>

<!--User Invitees search-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
      const taskInviteInput = document.getElementById('taskInviteInput');
      const userSuggestionList = document.getElementById('userSuggestionList');

      taskInviteInput.addEventListener('input', function () {
          const input = this.value.trim().toLowerCase();
          if (input === '') {
              userSuggestionList.style.display = 'none';
              userSuggestionList.innerHTML = '';
              return;
          }

          fetch(`/searchUsers/${input}`)
              .then(response => response.json())
              .then(users => {
                  userSuggestionList.innerHTML = '';
                  users.forEach(user => {
                      const userEntry = document.createElement('div');
                      userEntry.textContent = `${user.firstname} ${user.lastname} - ${user.accountType}`;
                      userEntry.classList.add('user-entry');
                      userEntry.addEventListener('click', function () {
                          taskInviteInput.value = `${user.firstname} ${user.lastname} - ${user.accountType}`;
                          userSuggestionList.style.display = 'none';
                      });
                      userSuggestionList.appendChild(userEntry);
                  });
                  userSuggestionList.style.display = 'block';
              })
              .catch(error => {
                  console.error('Error fetching user suggestions:', error);
              });
      });
  });
</script>
{% endblock %}